config:
  allure:
    epic: demo接口
    feature: demo模块
    story: yaml数据测试输出
  request:
    env: dev.env
    headers:
    timeout: 10
    verify: False
    redirects: True
    proxies:
      http:
      https:
  module: test

test_steps:
  - name: 查询
    case_id: event_query_001
    description: 测试关联变量
    is_run:
    request:
      method: get
      url: /posts/1
      params:
      headers:
      body_type:
      body:
      files:
    setup:
      testcase:
        - case_id: event_query_002
          key: rcode
          jsonpath: $.status_code
        - event_query_002
      hooks:
      wait_time: 0
    teardown:
      sql:
      hooks:
      extract:
        - key: test
          type: cache
          jsonpath: $.url
      assert:
        - check:
          value: ^rcode
          type: str_eq
          jsonpath: $.status_code
      wait_time: 0

  - name: 断言
    case_id: event_query_002
    description: 测试高级断言
    is_run:
    request:
      method: get
      url: /comments
      params:
        postId: 1
      headers:
      body_type:
      body:
      files:
    setup:
      testcase:
      wait_time: 0
    teardown:
      extract:
        - key: test
          type: env
          jsonpath: $.url
      assert:
        - assert 200 == pm.response.get('status_code')
        - assert 'postId' not in str(pm.response.get('content')), '没有返回content'

  - name: hooks
    case_id: event_create_001
    description: 测试全局变量和hooks
    is_run:
    request:
      method: post
      url: /posts
      params:
      headers:
      body_type: json
      body:
        title: foo
        body: this is a test; sum(a+b)=${sum_a_b(1,2)}; $test
        userId: 1
      files:
    setup:
      hooks:
        - ${current_time()}
    teardown:
      hooks:
        - ${random_phone()}
      extract:
        - key: test
          type: global
          jsonpath: $.url
      assert: assert 200 == pm.response.get('status_code')

  - name: super_relate_testcase
    case_id: event_relate_001
    description: 测试跨文件关联用例
    is_run:
    request:
      method: get
      url: /posts/1
      params:
      headers:
      body_type:
      body:
      files:
    setup:
      testcase:
        - event_upload_004
